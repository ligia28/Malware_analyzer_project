
rule suspicious_connect: EXE
{
	strings:
	$rule1 = "WSAConnect"
	$rule2 = /^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/
	$rule3 = "connect"
	$rule4 = "port"
	condition:
		$rule1 or $rule2 or $rule3 or $rule4
}

rule prime_numbers
{
	meta:
		description = "List with prime numbers"

	strings:
		$c0 = { 03 05 07 0B 0D 11 13 17 1D 1F 25 29 2B 2F 35 3B 3D 43 47 49 4F 53 59 61 65 67 6B 6D 71 7F 83 89 8B 95 97 9D A3 A7 AD B3 B5 BF C1 C5 C7 D3 DF E3 E5 E9 EF F1 FB }
	condition:
		$c0
}

rule big_numbers_found: EXE
{
	meta:
		description = "Search big numbers, 20,32,64,128"
	strings:
		$n0 = /[0-9a-fA-F]{20}/ fullword ascii
		$n1 = /[0-9a-fA-F]{32}/ fullword wide ascii
		$n2 = /[0-9a-fA-F]{48}/ fullword wide ascii
		$n3 = /[0-9a-fA-F]{64}/ fullword wide ascii
		$n4 = /[0-9a-fA-F]{128}/ fullword wide ascii
		$n5 = /[0-9a-fA-F]{256}/ fullword wide ascii
	condition:
		$n0 or $n1 or $n2 or $n3 or $n4 or $n5

}
rule advapi_hash_functions:EXE
{
	meta:
		description = "Advapi functions"
	strings:
		$advapi32 = "advapi32.dll" wide ascii nocase
		$create_hash = "CryptCreateHash" wide ascii
		$hash_data = "CryptHashData" wide ascii
		$context = "CryptAcquireContext" wide ascii
	condition:
		$advapi32 and ($create_hash and $hash_data and $context)
}

rule encrypt_library :EXE
{
	meta:
		description = "Cripto library"
	strings:
		$lib1 = "libeay.dll"
		$lib2 = "crypt32.dll"
		$lib3 = "libeay32.dll"
		$lib4 = "libeay64.lib"
		$lib5 = "CkCrypt2"
	condition:
		$lib1 or $lib2 or $lib3 or $lib4 or $lib5
}

rule encrypt_function_evp:EXE
{
	meta:
		description = "EVP encrypt funcions"
	strings:
		$f1  = "EVP_EncryptInit_ex"
		$f2 = "EVP_EncryptFinal_ex"
		$f3 = "EVP_CIPHER_CTX_set_padding"
		$f4 = "EVP_CIPHER_CTX_set_key_length"
		$f5 = "EVP_CIPHER_CTX_rand_key"
		$f6  =  "EVP_aes_128_cbc"
		$f7 = "EVP_aes_192_cbc"
		$f8 = "EVP_aes_256_cbc"
		$f9 = "EVP_des_cbc"
		$f10  =  "EVP_aes_128_ecb"
		$f11 = "EVP_aes_192_ecb"
		$f12 = "EVP_aes_256_ecb"
		$f13  =  "EVP_aes_128_cfb"
		$f14 = "EVP_aes_192_cfb"
		$f15 = "EVP_aes_256_cfb"
	condition:
		$f1 or $f2 or $f3 or $f4 or $f5 or $f6 or $f7 or $f8 or $f9 or $f10 or $f11 or $f12 or $f13 or $f14  or $f15  

}

rule encrypt_function_normal:EXE
{
	meta:
		description = "Normal encrypt funcions"
	strings:
		$f1  = "AES_cbc_encrypt"
		$f2 = "AES_ecb_encrypt"
		$f3 = "AES_cfb_encrypt"
		$f4 = "AES_ofb_encrypt"
		
	condition:
		$f1 or $f2 or $f3 or $f4 

}

rule rules_from_kernel32_createfile:EXE
{
	meta:
		description = "Rules from kernel32 lib"
	strings:
		$r1 = "CreateFileA"
		$r2 = "CreateFileMappingA"
		$r3 = "CreateFileW"
		$r4 = "DeleteFileA"
		$r5 = "DeleteFileW"
		$r6 = "WriteFile"
	condition:
		$r1 or $r2 or $r3 or $r4 or $r5 or $r6
}
rule rules_from_kernel32_createprocess:EXE
{
	meta:
		description = "Rules from kernel32 lib"
	strings:

		$r1 = "CreateProcessA"
		$r2 = "CreateProcessW"
		$r3 = "ExitProcess"
		$r4 = "ExitThread"
		$r5 = "GetCurrentProcess"
		$r6 = "WinExec"
	condition:
		$r1 or $r2 or $r3 or $r4 or $r5 or $r6
}
rule load_library_v_alloc:EXE
{
	strings:
		$r1 = "LoadLibraryA"
		$r2 = "LoadLibraryW"
		$r3 = "VirtualAlloc"
		$r4 = "VirtualProtect"

	condition:
		$r1 or $r2 or $r3 or $r4
}

rule http_found:EXE
{
	strings:
		$s_uri = /\(http.+\)/ ascii wide nocase
		$s2 = /www\.(\S)*/
	condition:
		$s_uri or $s2
}

rule path_found:EXE
{
	strings:
		$r1 = /((\S)*\/+)|(\/+(\S)*)*/
		$r2 = {4C 00 00 00 01 14 02 00}
		

	condition:
		$r1 or $r2

}

rule found_shellcode:EXE
{
	strings:
		$s0 = { 64 8b 64 }
        $s1 = { 64 a1 30 }
        $s2 = { 64 8b 15 30 }
        $s3 = { 64 8b 35 30 }
        $s4 = { 55 8b ec 83 c4 }
        $s5 = { 55 8b ec 81 ec }
        $s6 = { 55 8b ec e8 }
        $s7 = { 55 8b ec e9 }
	condition:
		for any of ($s*) : ($ at entrypoint)
}	